{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://lovable.com/schemas/biomarcadores-payload.json",
  "title": "Payload de Biomarcadores Laboratoriais",
  "description": "Schema de validação para dados de biomarcadores enviados pela Lambda AWS",
  "version": "1.0.0",
  "type": "object",
  "required": ["paciente_id", "biomarcadores"],
  "properties": {
    "paciente_id": {
      "type": "string",
      "description": "Identificador único do paciente",
      "minLength": 1,
      "maxLength": 100,
      "examples": ["12345", "PAC-001", "550e8400-e29b-41d4-a716-446655440000"]
    },
    "data_exame": {
      "type": "string",
      "description": "Data geral do exame (opcional se cada biomarcador tiver data específica)",
      "pattern": "^(\\d{2}/\\d{2}/\\d{4})|(\\d{4}-\\d{2}-\\d{2})|(\\d{2}-\\d{2}-\\d{4})$",
      "examples": ["25/10/2025", "2025-10-25", "25-10-2025"]
    },
    "laboratorio": {
      "type": "string",
      "description": "Nome do laboratório que realizou o exame",
      "minLength": 1,
      "maxLength": 200,
      "examples": ["LACI", "Laboratório Weinmann", "Fleury", "Delboni Auriemo"]
    },
    "biomarcadores": {
      "type": "array",
      "description": "Lista de biomarcadores extraídos do exame",
      "minItems": 1,
      "maxItems": 500,
      "items": {
        "type": "object",
        "required": ["nome", "valor"],
        "properties": {
          "nome": {
            "type": "string",
            "description": "Nome do biomarcador (pode ser variação, será normalizado)",
            "minLength": 2,
            "maxLength": 150,
            "examples": [
              "Glicemia Jejum",
              "Hemoglobina",
              "TSH",
              "Colesterol Total",
              "Creatinina"
            ]
          },
          "valor": {
            "description": "Valor medido do biomarcador",
            "oneOf": [
              {
                "type": "number",
                "description": "Valor numérico"
              },
              {
                "type": "string",
                "description": "Valor como string (permite notação científica e valores qualitativos)",
                "examples": [
                  "95",
                  "14.5",
                  "1.5e3",
                  "Negativo",
                  "Positivo",
                  "Não Reagente",
                  "Reagente",
                  "Indetectável"
                ]
              }
            ]
          },
          "unidade": {
            "type": "string",
            "description": "Unidade de medida do valor",
            "minLength": 1,
            "maxLength": 50,
            "examples": [
              "mg/dL",
              "g/dL",
              "μUI/mL",
              "ng/mL",
              "mmol/L",
              "U/L",
              "pg/mL",
              "mU/mL",
              "%",
              "fL",
              "mm³",
              "mil/mm³"
            ]
          },
          "referencia": {
            "type": "string",
            "description": "Valor ou faixa de referência",
            "maxLength": 200,
            "examples": [
              "70-100",
              "12-15.8",
              "<5",
              ">100",
              "4-5.4",
              "Negativo",
              "Não Reagente",
              "H<40 M<33",
              "0.4-4.0"
            ]
          },
          "data": {
            "type": "string",
            "description": "Data específica deste biomarcador",
            "pattern": "^(\\d{2}/\\d{2}/\\d{4})|(\\d{4}-\\d{2}-\\d{2})|(\\d{2}-\\d{2}-\\d{4})$",
            "examples": ["25/10/2025", "2025-10-25"]
          },
          "metodo": {
            "type": "string",
            "description": "Método utilizado para o exame (opcional)",
            "maxLength": 200,
            "examples": [
              "Quimioluminescência",
              "ELISA",
              "Imunoensaio",
              "Espectrofotometria",
              "HPLC"
            ]
          },
          "observacoes": {
            "type": "string",
            "description": "Observações adicionais do laboratório",
            "maxLength": 1000,
            "examples": [
              "Resultado em jejum de 12 horas",
              "Amostra hemolisada",
              "Valor borderline"
            ]
          }
        },
        "additionalProperties": false
      }
    },
    "metadata": {
      "type": "object",
      "description": "Metadados adicionais do exame",
      "properties": {
        "arquivo_origem": {
          "type": "string",
          "description": "Nome do arquivo PDF/imagem original",
          "examples": ["exame_hemograma_2025.pdf", "resultado_lab.jpg"]
        },
        "data_processamento": {
          "type": "string",
          "format": "date-time",
          "description": "Data e hora do processamento pela Lambda",
          "examples": ["2025-10-25T10:30:00Z"]
        },
        "versao_extrator": {
          "type": "string",
          "description": "Versão do sistema de extração",
          "examples": ["1.0.0", "2.1.3"]
        },
        "confianca": {
          "type": "number",
          "description": "Nível de confiança da extração (0-1)",
          "minimum": 0,
          "maximum": 1,
          "examples": [0.95, 0.87, 1.0]
        }
      }
    }
  },
  "additionalProperties": false,
  
  "examples": [
    {
      "paciente_id": "12345",
      "data_exame": "25/10/2025",
      "laboratorio": "LACI",
      "biomarcadores": [
        {
          "nome": "Glicemia Jejum",
          "valor": "95",
          "unidade": "mg/dL",
          "referencia": "70-100",
          "data": "25/10/2025"
        },
        {
          "nome": "Hemoglobina",
          "valor": "14.5",
          "unidade": "g/dL",
          "referencia": "12-15.8",
          "data": "25/10/2025"
        },
        {
          "nome": "TSH",
          "valor": "2.5",
          "unidade": "μUI/mL",
          "referencia": "0.4-4.0",
          "data": "25/10/2025"
        }
      ],
      "metadata": {
        "arquivo_origem": "exame_2025-10-25.pdf",
        "data_processamento": "2025-10-25T10:30:00Z",
        "versao_extrator": "1.0.0",
        "confianca": 0.95
      }
    }
  ],
  
  "definitions": {
    "biomarcador": {
      "type": "object",
      "description": "Estrutura de um biomarcador individual",
      "required": ["nome", "valor"],
      "properties": {
        "nome": {"type": "string"},
        "valor": {"oneOf": [{"type": "number"}, {"type": "string"}]},
        "unidade": {"type": "string"},
        "referencia": {"type": "string"},
        "data": {"type": "string"}
      }
    }
  }
}
